<!-- =========================
     domain.html  (FULL FILE)
     Save as: /domain.html
========================= -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>Domain — Davoren Insights</title>
  <meta name="description" content="Domain view: Signals, Essays, Labs, and Academy organized by lens." />
  <meta name="robots" content="index,follow" />

  <link rel="stylesheet" href="style.css" />
</head>

<body class="domain-page">

  <a class="skip-link" href="#main">Skip to content</a>

  <nav class="navbar" aria-label="Primary">
    <a href="index.html">Home</a>
    <a href="insights.html">Insights</a>
    <a href="academy.html">Academy</a>
    <a href="labs.html">Labs</a>
  </nav>

  <div class="background" aria-hidden="true"></div>

  <!-- HERO -->
  <header class="hero blog-hero" role="banner">
    <div class="hero-glow" aria-hidden="true"></div>
    <div class="particles" aria-hidden="true"></div>
    <div class="hero-bottom-glow" aria-hidden="true"></div>

    <div class="hero-content blog-hero-content">
      <h1 id="domainTitle">Domain</h1>
      <p class="hero-sub" id="domainSub">Signals, essays, labs, and academy — organized by lens.</p>
      <p class="format-promise muted" id="domainKicker"></p>
    </div>
  </header>

  <main id="main">

    <!-- SIGNALS -->
    <section class="home-section section-tint section-tint-a" aria-labelledby="signals-title">
      <div class="section-head">
        <h2 id="signals-title">Signals</h2>
        <a class="text-link" id="signalsBrowse" href="signals.html">Browse all →</a>
      </div>
      <div class="latest-grid" id="signalsGrid" aria-label="Signals grid"></div>
    </section>

    <!-- ESSAYS -->
    <section class="home-section section-tint section-tint-b" aria-labelledby="essays-title">
      <div class="section-head">
        <h2 id="essays-title">Essays</h2>
        <a class="text-link" id="essaysBrowse" href="essays.html">Browse all →</a>
      </div>
      <div class="latest-grid" id="essaysGrid" aria-label="Essays grid"></div>
    </section>

    <!-- LABS -->
    <section class="home-section section-tint section-tint-c" aria-labelledby="labs-title">
      <div class="section-head">
        <h2 id="labs-title">Labs</h2>
        <a class="text-link" href="labs.html">Open Labs →</a>
      </div>
      <div class="latest-grid" id="labsGrid" aria-label="Labs grid"></div>
    </section>

    <!-- ACADEMY -->
    <section class="home-section section-tint section-tint-b" aria-labelledby="academy-title">
      <div class="section-head">
        <h2 id="academy-title">Academy</h2>
        <a class="text-link" href="academy.html">Academy →</a>
      </div>

      <div class="latest-grid" id="academyGrid" aria-label="Academy grid"></div>

      <!-- Fallback panel when no courses exist -->
      <div id="academyFallback" class="academy-panel" style="margin-top:16px; display:none;">
        <div class="academy-content">
          <h3>Davoren Insights Academy</h3>
          <p class="muted">Programs will be introduced selectively. This domain track is in development.</p>
          <p class="academy-note">When ready, courses will appear here.</p>
        </div>
        <div class="academy-actions">
          <span class="academy-status">In development</span>
        </div>
      </div>
    </section>

  </main>

  <footer class="footer">
    <p>© 2026 Davoren Insights</p>
    <p class="muted">davoreninsights@gmail.com</p>
    <p class="footer-links">
      <a href="index.html">Home</a> •
      <a href="insights.html">Insights</a> •
      <a href="labs.html">Labs</a> •
      <a href="academy.html">Academy</a>
    </p>
  </footer>

  <!-- CONTENT REGISTRY -->
  <script src="content-index.js"></script>

  <!-- DOMAIN RENDER -->
  <script>
    (function () {
      const params = new URLSearchParams(window.location.search);
      const lens = (params.get("lens") || "innovation").toLowerCase();

      const LENS_META = {
        innovation: {
          title: "Innovation",
          sub: "Constraint-driven redesign. Adoption reality. Industrial shifts.",
          kicker: "Innovation Architectures • Systems Design • Commercialisation"
        },
        valence: {
          title: "Valence",
          sub: "Carbon as infrastructure. MRV logic. Incentives + integrity.",
          kicker: "Carbon Systems • MRV • Integrity & Incentives"
        },
        futures: {
          title: "Futures",
          sub: "Signals. Second-order effects. Opportunity windows.",
          kicker: "Directional Intelligence • Risk Horizons • Timing"
        },
        decision: {
          title: "Decision",
          sub: "Coordination failure. Decision friction. Adoption reality.",
          kicker: "Execution Systems • Coordination Debt • Institutions"
        },
        human: {
          title: "Human",
          sub: "Teams, incentives, and coordination design under real constraints.",
          kicker: "Human Systems • Teams • Coordination Fit"
        }
      };

      const meta = LENS_META[lens] || LENS_META.innovation;

      // Title + hero copy
      document.title = `${meta.title} — Davoren Insights`;
      document.getElementById("domainTitle").textContent = meta.title;
      document.getElementById("domainSub").textContent = meta.sub;
      document.getElementById("domainKicker").textContent = meta.kicker;

      // “Browse all” links filtered
      document.getElementById("signalsBrowse").href = `signals.html?lens=${encodeURIComponent(lens)}`;
      document.getElementById("essaysBrowse").href = `essays.html?lens=${encodeURIComponent(lens)}`;

      // Pull content
      const signals = ((window.CONTENT && window.CONTENT.signals) || [])
        .filter(x => ((x.lens || "").toLowerCase() === lens))
        .slice(0, 3);

      const essays = ((window.CONTENT && window.CONTENT.essays) || [])
        .filter(x => ((x.lens || "").toLowerCase() === lens))
        .slice(0, 3);

      const labs = ((window.CONTENT && window.CONTENT.labs) || [])
        .filter(x => ((x.lens || "").toLowerCase() === lens))
        .slice(0, 3);

      const academy = ((window.CONTENT && window.CONTENT.academy) || [])
        .filter(x => ((x.lens || "").toLowerCase() === lens))
        .slice(0, 3);

      // Render
      renderCards("signalsGrid", signals, "signal");
      renderCards("essaysGrid", essays, "essay");
      renderLabCards("labsGrid", labs);
      renderCards("academyGrid", academy, "academy");

      // Academy fallback panel
      const fallback = document.getElementById("academyFallback");
      if (!academy.length) fallback.style.display = "flex";

      function renderCards(containerId, items, type) {
        const el = document.getElementById(containerId);
        el.innerHTML = "";

        if (!items.length) {
          el.innerHTML = emptyCard(type);
          return;
        }

        items.forEach(item => {
          const a = document.createElement("a");
          a.className = "blog-card";
          a.href = item.href;

          // lens line (subtle top border via CSS if you keep your lens helpers)
          a.setAttribute("data-lens", (item.lens || lens));

          const tags = Array.isArray(item.tags) ? item.tags : [];
          const badge = item.badge || (type === "signal" ? "Signal" : type === "essay" ? "Essay" : "Item");

          a.innerHTML = `
            <div class="card-top">
              <span class="badge ${badgeClass(type)}">${escapeHtml(badge)}</span>
              <span class="card-meta">${escapeHtml(item.meta || "")}</span>
            </div>
            <h3>${escapeHtml(item.title || "Untitled")}</h3>
            ${item.desc ? `<p>${escapeHtml(item.desc)}</p>` : ``}
            <div class="card-tags" aria-label="Tags">
              ${tags.slice(0, 2).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
            </div>
          `;

          el.appendChild(a);
        });
      }

      function renderLabCards(containerId, items) {
        const el = document.getElementById(containerId);
        el.innerHTML = "";

        if (!items.length) {
          el.innerHTML = emptyCard("labs");
          return;
        }

        items.forEach(item => {
          const a = document.createElement("a");
          a.className = "blog-card";
          a.href = item.href;
          a.target = "_blank";
          a.rel = "noopener noreferrer";
          a.setAttribute("data-lens", (item.lens || lens));

          const tags = Array.isArray(item.tags) ? item.tags : [];

          a.innerHTML = `
            <div class="card-top">
              <span class="badge badge-framework">Lab</span>
              <span class="card-meta">${escapeHtml(item.status || "Live")}</span>
            </div>
            <h3>${escapeHtml(item.title || "Untitled Lab")}</h3>
            ${item.desc ? `<p>${escapeHtml(item.desc)}</p>` : ``}
            <div class="card-tags" aria-label="Tags">
              ${tags.slice(0, 2).map(t => `<span class="tag">${escapeHtml(t)}</span>`).join("")}
            </div>
          `;

          el.appendChild(a);
        });
      }

      function badgeClass(type) {
        if (type === "signal") return "badge-signal";
        if (type === "essay") return "badge-essay";
        if (type === "academy") return "badge-framework";
        return "badge-framework";
      }

      function emptyCard(type) {
        const label = (type === "labs") ? "No labs listed yet" : "Coming soon";
        return `
          <div class="blog-card" aria-disabled="true">
            <div class="card-top">
              <span class="badge badge-framework">${label}</span>
              <span class="card-meta">—</span>
            </div>
            <h3>Nothing to show yet</h3>
            <p class="muted">This domain will fill out as you publish.</p>
            <div class="card-tags" aria-label="Tags">
              <span class="tag">In development</span>
            </div>
          </div>
        `;
      }

      // Minimal safety (prevents accidental HTML injection from content-index.js)
      function escapeHtml(str) {
        return String(str)
          .replaceAll("&", "&amp;")
          .replaceAll("<", "&lt;")
          .replaceAll(">", "&gt;")
          .replaceAll('"', "&quot;")
          .replaceAll("'", "&#039;");
      }

    })();
  </script>

</body>
</html>
